<!DOCTYPE html>
<html lang="en">
  <head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCP Monte Carlo Simulation</title>
    <link rel="stylesheet" href="style.css">
    <script src="http://scheduler.dev.robert.office.distributive.network/dcp-client/dcp-client.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="text/javascript" id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  </head>
  <body>
    <h1>Monte Carlo Distributions with DCP</h1>
    <div id="plotContainer">
      <canvas id="myCanvas"></canvas>
    </div>
    <form id="addDataSetForm">
      <button id="submitButton" type="submit">Add New Dataset</button>
      <p id="numIterations"></p>
    </form>
    <div id="latexContainer">
      <p>Formula for simulation: </p>
      <div id="formula"></div>
    </div>
    <script type="module">
      import { createChart } from './chart-module.js';
      import { setupForm } from './form-module.js';
      document.addEventListener("DOMContentLoaded", async () => {
        // Fetch job data
        const res = await fetch('../out.json');
        const resJSON = await res.json();
        const modelResults = [];
        for (let i = 0; i < resJSON.length; i++ )
        {
          if (!(resJSON[i] instanceof Array))
            modelResults[i] = window.dcp.kvin.deserialize(resJSON[i]);
          else
            modelResults[i] = resJSON[i];
        }

        const unitCircleData = [];
        for (let angle = 0; angle <= Math.PI*2; angle += 0.01) 
        {
            const x = Math.cos(angle);
            const y = Math.sin(angle);
            unitCircleData.push({ x, y });
        }
        // Create and display the chart
        const squareData = [{ x: -1, y: -1 },    
                      { x: -1, y: 1 },    
                      { x: 1, y: 1 }, 
                      { x: 1, y: -1 }, 
                      { x: -1, y: -1} ];
        const ctx = document.getElementById("myCanvas").getContext("2d");
        plotContainer.innerHTML = ""; // Clear previous chart
        plotContainer.appendChild(ctx.canvas);
        const chart = createChart(unitCircleData, squareData)
        setupForm(modelResults, chart);
      });
    </script>
  </body>
</html>